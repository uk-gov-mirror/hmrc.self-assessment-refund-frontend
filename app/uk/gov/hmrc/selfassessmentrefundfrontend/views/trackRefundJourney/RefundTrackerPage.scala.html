@*
 * Copyright 2023 HM Revenue & Customs
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *     http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 *@

@import uk.gov.hmrc.govukfrontend.views.html.components.GovukTabs
@import uk.gov.hmrc.govukfrontend.views.viewmodels.content.HtmlContent
@import uk.gov.hmrc.govukfrontend.views.viewmodels.tabs.{TabItem, TabPanel, Tabs}
@import uk.gov.hmrc.selfassessmentrefundfrontend.model.page.RefundTrackerPageModel.RefundTrackerModel
@import uk.gov.hmrc.selfassessmentrefundfrontend.views.components.PageTitle
@import uk.gov.hmrc.selfassessmentrefundfrontend.views.html.components.{Layout, RefundTable}


@this(
layout: Layout,
refundTable: RefundTable,
govukTabs : GovukTabs
)

@(yearlyRefundsModel: Map[Int, Seq[RefundTrackerModel]], creditAndRefundsUrl: String)(implicit request: Request[_], messages: Messages)


@tabItemsList = @{
    yearlyRefundsModel.map { case (year, refundModel) =>
        TabItem(
            id = Some("id"+year.toString),
            label = year.toString,
            panel = TabPanel(
                content = HtmlContent(refundTable(refundModel, year.toString))
            )
        )
    }.toSeq
}

@layout(
    pageTitle = Some(PageTitle(messages("refund-tracker.title"), messages("service.name.track"))),
    serviceName = Some(messages("service.name.track"))
) {
    <h1 class="govuk-heading-l">@messages("refund-tracker.heading")</h1>

    @if(yearlyRefundsModel.nonEmpty) {
        @govukTabs(Tabs(items = tabItemsList))
    } else {
        <p class="govuk-body">@messages("refund.no-history.message1")</p>
        <p class="govuk-body">@messages("refund.no-history.message2a") <a class="govuk-link" href=@creditAndRefundsUrl>@messages("refund.no-history.message2b")</a>.</p>
    }
}
